function loadShader(e){e=document.getElementById("shader/"+e);if(!e)return null;for(var r,a="",o=e.firstChild;o;)3===o.nodeType&&(a+=o.textContent),o=o.nextSibling;if(a=a.trim(),"x-shader/x-vertex"==e.type)r=gl.createShader(gl.VERTEX_SHADER);else{if("x-shader/x-fragment"!=e.type)return null;r=gl.createShader(gl.FRAGMENT_SHADER)}return gl.shaderSource(r,a),gl.compileShader(r),gl.getShaderParameter(r,gl.COMPILE_STATUS)?(logExtra(gl.getShaderInfoLog(r)),r):(logError(gl.getShaderInfoLog(r)),null)}function getAdvancedMaterial(e,r){var a=0,o=0,n=.2,t=.9,l=.5,g=.1,s=.6;210==e.type||211==e.type?(t=.9,l=.35,n=.2,g=.3,s=.07):11<=e.type&&e.type<=85?(n=.3,t=.8,l=.7,g=.35,s=.1,o=.01):227==e.type||228==e.type?(t=1,l=0,g=.35,s=.05):107==e.type||230==e.type||232==e.type||239==e.type||240==e.type||243==e.type||244==e.type||248==e.type||253==e.type?(t=.9,l=.7,g=1,s=.1,o=.3):217==e.type||218==e.type||229==e.type||231==e.type?(t=.9,l=.5,g=0):103==e.type||104==e.type||255==e.type?(t=.9,l=.7,g=1,o=s=.1):200==e.type||108==e.type||109==e.type?(t=.5,g=0,a=.8):241==e.type&&(t=1,g=l=n=0),r.uEmission1f=a,r.uReflection1f=o,r.uAmbientFactor1f=n,r.uDiffuseFactor1f=t,r.uDiffuseRoughness1f=l,r.uSpecularFactor1f=g,r.uSpecularRoughness1f=s}function webGLStart(){if(gl=createContext(canvas,{premultipliedAlpha:!1}),!gl)return!1;$(window).resize(onResize),$(document).on("fullscreenchange",onResize),canvas.addEventListener("DOMMouseScroll",handleMouseWheel),$("#sceneInfoWrapper").on("mousedown",function(e){!1===glScene.showSceneOptions&&handleMouseDown(e)}),$("#sceneInfoWrapper").on("mouseup",function(e){handleMouseUp(e)}),canvas.onmousewheel=handleMouseWheel,canvas.onmousedown=handleMouseDown,document.onmouseup=handleMouseUp,document.onmousemove=handleMouseMove;var e="<svg xmlns='http://www.w3.org/2000/svg' id='canvasCenter' style='position:absolute;width:1rem;height:1rem;cursor:pointer' viewBox='5 5 14 14'>  <path "+("stroke='none' fill='"+viewerSettings.frontColorStr+"'")+" d='M15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9A3,3 0 0,1 15,12Z'></path></svg>";$("#canvasContainer").append(e),$("#canvasCenter")[0].onmousedown=handleMouseDown;for(var r=2*Math.PI/glScene.oNavigation.rotate.numItems,a=[],o=0;o<2*Math.PI;o+=r)a.push(.9*Math.sin(o)),a.push(.9*Math.cos(o));glScene.oNavigation.rotate.id=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.oNavigation.rotate.id),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(a).buffer,gl.STATIC_DRAW),glScene.oNavigation.scale.id=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.oNavigation.scale.id),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]).buffer,gl.STATIC_DRAW);for(var n=[],o=-100;o<=100;o++){var t=0,l=-1;o%10==0&&(t=0,l=-2),n.push(o),n.push(t),n.push(o),n.push(l)}for(o=-1e3;o<=1e3;o+=25){var g=o/100;n.push(g),n.push(0),n.push(g),n.push(-.2)}n.push(-100),n.push(0),n.push(100),n.push(0);for(var s=n.length,o=0;o<s;o+=2)n.push(n[o+1]),n.push(n[o+0]);n.push(.8),n.push(-1.5),n.push(1),n.push(-1.2),n.push(1),n.push(-1.2),n.push(1),n.push(-2);for(var i=0;i<2;i++){var c=1.2+.8*i;n.push(c),n.push(-2),n.push(c),n.push(-1.5),n.push(.3+c),n.push(-2),n.push(.3+c),n.push(-1.5),n.push(.6+c),n.push(-2),n.push(.6+c),n.push(-1.5),n.push(c),n.push(-1.7),n.push(.3+c),n.push(-1.5),n.push(.3+c),n.push(-1.7),n.push(.6+c),n.push(-1.5)}glScene.gridOverlay.numItems=n.length/2,glScene.gridOverlay.id=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.gridOverlay.id),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(n).buffer,gl.STATIC_DRAW);var d=loadShader("simple.vert"),m=loadShader("simple.frag"),u=loadShader("advanced1.vert"),h=loadShader("advanced1.frag"),f=loadShader("overlay.vert"),e=loadShader("overlay.frag");return d&&m&&u&&h&&f&&e||(alert("Error: Could not compile shader"),glScene.shaderFail=!0),glScene.shaderPrograms=[],glScene.shaderPrograms.simple=gl.createProgram(),glScene.shaderPrograms.advanced1=gl.createProgram(),glScene.shaderPrograms.overlay=gl.createProgram(),gl.attachShader(glScene.shaderPrograms.simple,d),gl.attachShader(glScene.shaderPrograms.simple,m),gl.attachShader(glScene.shaderPrograms.advanced1,u),gl.attachShader(glScene.shaderPrograms.advanced1,h),gl.attachShader(glScene.shaderPrograms.overlay,f),gl.attachShader(glScene.shaderPrograms.overlay,e),gl.bindAttribLocation(glScene.shaderPrograms.simple,0,"positions"),gl.bindAttribLocation(glScene.shaderPrograms.simple,1,"positions2"),gl.bindAttribLocation(glScene.shaderPrograms.simple,2,"normals"),gl.bindAttribLocation(glScene.shaderPrograms.simple,3,"texcoords"),gl.bindAttribLocation(glScene.shaderPrograms.simple,4,"colors"),gl.bindAttribLocation(glScene.shaderPrograms.simple,5,"colors2"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,0,"positions"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,1,"positions2"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,2,"normals"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,3,"texcoords"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,4,"colors"),gl.bindAttribLocation(glScene.shaderPrograms.advanced1,5,"colors2"),gl.bindAttribLocation(glScene.shaderPrograms.overlay,0,"positions"),gl.linkProgram(glScene.shaderPrograms.simple),gl.getProgramParameter(glScene.shaderPrograms.simple,gl.LINK_STATUS)||logError(gl.getProgramInfoLog(glScene.shaderPrograms.simple)),logExtra(gl.getProgramInfoLog(glScene.shaderPrograms.simple)),gl.linkProgram(glScene.shaderPrograms.advanced1),gl.getProgramParameter(glScene.shaderPrograms.advanced1,gl.LINK_STATUS)||logError(gl.getProgramInfoLog(glScene.shaderPrograms.advanced1)),logExtra(gl.getProgramInfoLog(glScene.shaderPrograms.advanced1)),gl.linkProgram(glScene.shaderPrograms.overlay),gl.getProgramParameter(glScene.shaderPrograms.overlay,gl.LINK_STATUS)||logError(gl.getProgramInfoLog(glScene.shaderPrograms.overlay)),logExtra(gl.getProgramInfoLog(glScene.shaderPrograms.overlay)),gl.useProgram(glScene.shaderPrograms.simple),glScene.shaderPrograms.simple.mModelView=gl.getUniformLocation(glScene.shaderPrograms.simple,"mModelView"),glScene.shaderPrograms.simple.mProj=gl.getUniformLocation(glScene.shaderPrograms.simple,"mProj"),glScene.shaderPrograms.simple.mNorm=gl.getUniformLocation(glScene.shaderPrograms.simple,"mNorm"),glScene.shaderPrograms.simple.colorTex=gl.getUniformLocation(glScene.shaderPrograms.simple,"colorTex"),glScene.shaderPrograms.simple.transparency=gl.getUniformLocation(glScene.shaderPrograms.simple,"transparency"),glScene.shaderPrograms.simple.frontColor=gl.getUniformLocation(glScene.shaderPrograms.simple,"frontColor"),glScene.shaderPrograms.simple.backColor=gl.getUniformLocation(glScene.shaderPrograms.simple,"backColor"),glScene.shaderPrograms.simple.useFrontColor=gl.getUniformLocation(glScene.shaderPrograms.simple,"useFrontColor"),glScene.shaderPrograms.simple.useBackColor=gl.getUniformLocation(glScene.shaderPrograms.simple,"useBackColor"),glScene.shaderPrograms.simple.useTexture=gl.getUniformLocation(glScene.shaderPrograms.simple,"useTexture"),glScene.shaderPrograms.simple.useVertexColor=gl.getUniformLocation(glScene.shaderPrograms.simple,"useVertexColor"),glScene.shaderPrograms.simple.uClipPlaneOS=gl.getUniformLocation(glScene.shaderPrograms.simple,"uClipPlaneOS"),glScene.shaderPrograms.simple.uBrightness1f=gl.getUniformLocation(glScene.shaderPrograms.simple,"uBrightness1f"),glScene.shaderPrograms.simple.positionAnimationPos=gl.getUniformLocation(glScene.shaderPrograms.simple,"positionAnimationPos"),glScene.shaderPrograms.simple.colorAnimationPos=gl.getUniformLocation(glScene.shaderPrograms.simple,"colorAnimationPos"),gl.useProgram(glScene.shaderPrograms.advanced1),glScene.shaderPrograms.advanced1.mModelView=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"mModelView"),glScene.shaderPrograms.advanced1.mProj=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"mProj"),glScene.shaderPrograms.advanced1.mNorm=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"mNorm"),glScene.shaderPrograms.advanced1.colorTex=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"colorTex"),glScene.shaderPrograms.advanced1.nanTextureColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"nanTextureColor"),glScene.shaderPrograms.advanced1.transparency=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"transparency"),glScene.shaderPrograms.advanced1.frontColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"frontColor"),glScene.shaderPrograms.advanced1.backColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"backColor"),glScene.shaderPrograms.advanced1.useFrontColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"useFrontColor"),glScene.shaderPrograms.advanced1.useBackColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"useBackColor"),glScene.shaderPrograms.advanced1.useTexture=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"useTexture"),glScene.shaderPrograms.advanced1.useVertexColor=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"useVertexColor"),glScene.shaderPrograms.advanced1.uClipPlaneOS=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uClipPlaneOS"),glScene.shaderPrograms.advanced1.uBrightness1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uBrightness1f"),glScene.shaderPrograms.advanced1.uEmission1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uEmission1f"),glScene.shaderPrograms.advanced1.uReflection1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uReflection1f"),glScene.shaderPrograms.advanced1.uAmbientFactor1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uAmbientFactor1f"),glScene.shaderPrograms.advanced1.uDiffuseFactor1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uDiffuseFactor1f"),glScene.shaderPrograms.advanced1.uDiffuseRoughness1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uDiffuseRoughness1f"),glScene.shaderPrograms.advanced1.uSpecularFactor1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uSpecularFactor1f"),glScene.shaderPrograms.advanced1.uSpecularRoughness1f=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"uSpecularRoughness1f"),glScene.shaderPrograms.advanced1.positionAnimationPos=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"positionAnimationPos"),glScene.shaderPrograms.advanced1.colorAnimationPos=gl.getUniformLocation(glScene.shaderPrograms.advanced1,"colorAnimationPos"),gl.useProgram(glScene.shaderPrograms.overlay),glScene.shaderPrograms.overlay.mProj=gl.getUniformLocation(glScene.shaderPrograms.overlay,"mProj"),onResize(),gl.clearColor(viewerSettings.backColor[0]/255,viewerSettings.backColor[1]/255,viewerSettings.backColor[2]/255,1),gl.clearDepth(1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),!0}function updateShader(){for(var e=null!==glScene.previewedShader?glScene.shaderPrograms[glScene.previewedShader]:glScene.shaderPrograms[glScene.selectedShader],r=0;r<activeModel.objects.length;++r)activeModel.objects[r].sProgram=e;renderFrame()}function getCameraViewMatrix(){var e=mat4.create();return mat4.identity(e),mat4.multiply(e,e,glScene.rotMatrix),mat4.translate(e,e,glScene.translVec),e}function getCameraProjectionMatrix(){var e=Math.max(activeModel.boundingBox.maxPos[0]-activeModel.boundingBox.minPos[0],activeModel.boundingBox.maxPos[1]-activeModel.boundingBox.minPos[1]),r=1/glScene.zoomFactor*e*1.2/2,e=mat4.create();return canvas.width>=canvas.height?mat4.ortho(e,-r*canvas.width/canvas.height,r*canvas.width/canvas.height,-r,r,-200,200):mat4.ortho(e,-r,r,-r*canvas.height/canvas.width,r*canvas.height/canvas.width,-200,200),e}function renderFrame(){gl.colorMask(!0,!0,!0,!0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.colorMask(!0,!0,!0,!1),gl.viewport(0,0,canvas.width,canvas.height);var e,r,a,o,n=getCameraProjectionMatrix(),t=getCameraViewMatrix(),l=vec4.fromValues(1,0,0,123456);0<activeModel.ClipKind&&activeModel.ClipKind<=3?(e=activeModel.ClipKind-1,r=activeModel.boundingBox.minPos[e]-.1,a=activeModel.boundingBox.maxPos[e]+.1,o=.5*activeModel.ClipPosition+.5,(l=vec4.fromValues(0,0,0,(r*(1-o)+a*o)*(activeModel.ClipInvert?1:-1)))[e]=activeModel.ClipInvert?1:-1):4==activeModel.ClipKind&&(l=activeModel.ClipPlaneCustom);for(var g,s,i={11:0,227:1,228:1,210:2,211:2,245:3,246:3,107:4},c=0;c<2;c++){for(var d,m,u=[],h=0;h<activeModel.objects.length;h++)0==c==(1==(f=activeModel.objects[h]).opacity)&&-1===glScene.skipGroups.indexOf(f.group)&&(d=vec3.create(),vec3.lerp(d,f.boundingBox.minPos,f.boundingBox.maxPos,.5),vec3.transformMat4(d,d,f.transform),vec3.transformMat4(d,d,t),11<=(m=f.type)&&m<=85&&(m=11),u.push({d:d[2],objIdx:h,type:m}));0==c?u.sort(function(e,r){return r.d-e.d}):u.sort(function(e,r){var a=i[e.type],o=i[r.type];return(a=void 0===a?12345:a)==(o=void 0===o?12345:o)?e.d-r.d:a-o});for(var f,v=0;v<u.length;++v)if(!0===(f=activeModel.objects[u[v].objIdx]).isVisible){var P=f.transform,p=mat4.create();mat4.multiply(p,t,P);mat4.create();var S=mat3.create();mat3.fromMat4(S,p),mat3.invert(S,S),mat3.transpose(S,S),gl.useProgram(f.sProgram),gl.uniformMatrix4fv(f.sProgram.mProj,!1,n),gl.uniformMatrix4fv(f.sProgram.mModelView,!1,p),gl.uniformMatrix3fv(f.sProgram.mNorm,!1,S),gl.uniform1f(f.sProgram.transparency,f.opacity),gl.uniform1i(f.sProgram.useFrontColor,f.useFaceColor),gl.uniform1i(f.sProgram.useBackColor,f.useBackColor),gl.uniform3fv(f.sProgram.frontColor,f.faceColor.RGB),gl.uniform3fv(f.sProgram.backColor,f.backColor.RGB);var b,A,w,x,F,L,R=vec4.fromValues(1,0,0,123456);f.doClip&&0<activeModel.ClipKind&&activeModel.ClipKind<=4&&(x=mat4.create(),l[3]=-l[3],mat4.transpose(x,P),vec4.transformMat4(R,l,x),l[3]=-l[3],R[3]=-R[3]),gl.uniform4fv(f.sProgram.uClipPlaneOS,[R[0],R[1],R[2],R[3]]),gl.uniform1f(f.sProgram.uBrightness1f,activeModel.brightness),f.sProgram===glScene.shaderPrograms.advanced1&&(getAdvancedMaterial(f,L=[]),b=L.uEmission1f,F=L.uReflection1f,A=L.uAmbientFactor1f,w=L.uDiffuseFactor1f,p=L.uDiffuseRoughness1f,S=L.uSpecularFactor1f,P=L.uSpecularRoughness1f,x=vec3.fromValues(1,1,1),f.useTexture&&f.textureIsOriginal&&(0!=f.type&&242!=f.type&&210!=f.type&&211!=f.type||(A=.5,w=.7,x=vec3.fromValues(.8,.8,.8))),R=3*(activeModel.specular-1)+1,P=clamp(P*R,0,1),F=clamp(F*R,0,1),p+=(L=2*(activeModel.softFocus-1))*p*.8,w+=R=-L*w*.4,A+=.8*-R,F+=-L*F*.5,w=clamp(w,0,1),p=clamp(p,0,1),A=clamp(A,0,1),S=clamp(S,0,1),P=clamp(P,0,1),b=clamp(b,0,.5),F=clamp(F,0,.5),gl.uniform1f(f.sProgram.uEmission1f,b),gl.uniform1f(f.sProgram.uReflection1f,F),gl.uniform1f(f.sProgram.uAmbientFactor1f,A),gl.uniform1f(f.sProgram.uDiffuseFactor1f,w),gl.uniform1f(f.sProgram.uDiffuseRoughness1f,p),gl.uniform1f(f.sProgram.uSpecularFactor1f,S),gl.uniform1f(f.sProgram.uSpecularRoughness1f,P),gl.uniform3fv(f.sProgram.nanTextureColor,x)),-1!==f.texture.id&&f.useTexture?(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,f.texture.id),gl.uniform1i(f.sProgram.useTexture,!0)):(gl.bindTexture(gl.TEXTURE_2D,null),gl.uniform1i(f.sProgram.useTexture,!1)),gl.uniform1i(f.sProgram.useVertexColor,!1);for(var C=0;C<f.objectParts.length;++C){gl.enableVertexAttribArray(0),gl.enableVertexAttribArray(1),gl.enableVertexAttribArray(2);var y=f.objectParts[C];gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexCoordinates.id),gl.vertexAttribPointer(0,3,gl.FLOAT,!1,0,0),-1===y.vertexCoordinates2.id?gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexCoordinates.id):gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexCoordinates2.id),gl.vertexAttribPointer(1,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexNormals.id),gl.vertexAttribPointer(2,3,gl.FLOAT,!1,0,0),gl.uniform1f(f.sProgram.positionAnimationPos,y.vertexCoordinatesAnimationParameter),gl.uniform1f(f.sProgram.colorAnimationPos,y.vertexColorsAnimationParameter),null!==f.texture.image&&f.useTexture?(gl.enableVertexAttribArray(3),gl.bindBuffer(gl.ARRAY_BUFFER,y.textureCoordinates.id),gl.vertexAttribPointer(3,2,gl.FLOAT,!1,0,0)):gl.disableVertexAttribArray(3),-1!==y.vertexColors.id&&f.useTexture?(gl.enableVertexAttribArray(4),gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexColors.id),gl.vertexAttribPointer(4,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(5),-1===y.vertexColors2.id?gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexColors.id):gl.bindBuffer(gl.ARRAY_BUFFER,y.vertexColors2.id),gl.vertexAttribPointer(5,3,gl.FLOAT,!1,0,0),gl.uniform1i(f.sProgram.useVertexColor,!0)):(gl.disableVertexAttribArray(4),gl.disableVertexAttribArray(5),gl.uniform1i(f.sProgram.useVertexColor,!1)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,y.triangleIndices.id),1==f.opacity?gl.drawElements(gl.TRIANGLES,y.triangleIndices.numItems,gl.UNSIGNED_SHORT,0):(gl.enable(gl.CULL_FACE),gl.cullFace(gl.FRONT),gl.drawElements(gl.TRIANGLES,y.triangleIndices.numItems,gl.UNSIGNED_SHORT,0),gl.cullFace(gl.BACK),gl.drawElements(gl.TRIANGLES,y.triangleIndices.numItems,gl.UNSIGNED_SHORT,0),gl.disable(gl.CULL_FACE))}}}!0!==glScene.oNavigation.show&&!0!==glScene.gridOverlay.show||(gl.useProgram(glScene.shaderPrograms.overlay),gl.disableVertexAttribArray(1),gl.disableVertexAttribArray(2),gl.disableVertexAttribArray(3),gl.disableVertexAttribArray(4),gl.disableVertexAttribArray(5),gl.lineWidth(5),!0===glScene.oNavigation.show&&(g=mat4.create(),canvas.width>=canvas.height?mat4.ortho(g,-1*canvas.width/canvas.height,+canvas.width/canvas.height,-1,1,-200,200):mat4.ortho(g,-1,1,-1*canvas.height/canvas.width,+canvas.height/canvas.width,-200,200),gl.uniformMatrix4fv(glScene.shaderPrograms.overlay.mProj,!1,g),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.oNavigation.rotate.id),gl.vertexAttribPointer(0,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.LINE_LOOP,0,glScene.oNavigation.rotate.numItems),gl.viewport(20,0,canvas.width-40,canvas.height),s=mat4.create(),mat4.ortho(s,0,1,0,1,-100,100),gl.uniformMatrix4fv(glScene.shaderPrograms.overlay.mProj,!1,s),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.oNavigation.scale.id),gl.vertexAttribPointer(0,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.LINES,0,glScene.oNavigation.scale.numItems)),!0===glScene.gridOverlay.show&&(gl.viewport(0,0,canvas.width,canvas.height),g=mat4.create(),s=Math.max(activeModel.boundingBox.maxPos[0]-activeModel.boundingBox.minPos[0],activeModel.boundingBox.maxPos[1]-activeModel.boundingBox.minPos[1]),s=1/glScene.zoomFactor*s*1.2/2,canvas.width>=canvas.height?mat4.ortho(g,-s*canvas.width/canvas.height,s*canvas.width/canvas.height,-s,s,-200,200):mat4.ortho(g,-s,s,-s*canvas.height/canvas.width,s*canvas.height/canvas.width,-200,200),gl.uniformMatrix4fv(glScene.shaderPrograms.overlay.mProj,!1,g),gl.bindBuffer(gl.ARRAY_BUFFER,glScene.gridOverlay.id),gl.vertexAttribPointer(0,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.LINES,0,glScene.gridOverlay.numItems)),gl.enableVertexAttribArray(1))}function createContext(e,r){window.WebGLRenderingContext||e.parentNode&&(e.parentNode.innerHTML='Your browser does not support WebGL.<br />Get <a href="http://get.webgl.org">further information</a>');for(var a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],o=null,n=0;n<a.length;++n)try{if(o=e.getContext(a[n],r))break}catch(e){logError(e)}return o||e.parentNode&&(e.parentNode.innerHTML='It seems your computer does not support WebGL.<br />Get <a href="http://get.webgl.org/troubleshooting">further information</a>'),o}!function(e){"use strict";var r,e=(e.Element||e.HTMLElement).prototype;function a(e){var r=document.createEvent("CustomEvent");r.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(r)}function o(e){var r=document.createEvent("CustomEvent");r.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(r)}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e,r){return window.setTimeout(e,1e3/60)},window.cancelAnimFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.clearTimeout,window.createObjectURL=(window.URL||window.webkitURL).createObjectURL,window.revokeObjectURL=(window.URL||window.webkitURL).revokeObjectURL,document.hasOwnProperty("fullscreenEnabled")||(r="webkitIsFullScreen"in document?function(){return document.webkitIsFullScreen}:"mozFullScreen"in document?function(){return document.mozFullScreen}:function(){return!1},Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:r})),document.hasOwnProperty("fullscreenElement")||(r="webkitFullscreenElement"in document?function(){return document.webkitFullscreenElement}:"mozFullscreenElement"in document?function(){return document.mozFullscreenElement}:function(){return null},Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:r})),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("webkitfullscreenerror",o,!1),document.addEventListener("mozfullscreenerror",o,!1),e.requestFullscreen||(e.requestFullscreen=e.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:e.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}),document.exitFullscreen||(document.exitFullscreen=document.webkitExitFullscreen||document.mozExitFullscreen||function(){})}(window);